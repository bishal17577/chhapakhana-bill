<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grajuri Chhapakhana - Billing System</title>
    <style>
        /* --- General Styling --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #333;
            --bg-color: #fff;
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background-color: var(--secondary-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            width: 95%;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            background-color: var(--bg-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        /* --- Navigation --- */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px 8px 0 0;
        }
        nav h1 {
            margin: 0;
            font-size: 1.5em;
        }
        nav button {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
        }
        nav button:hover {
            background-color: #eef;
        }

        /* --- Main Content Layout --- */
        .main-content {
            display: none; /* Hidden by default */
        }
        .main-content.active {
            display: block; /* Shown when active */
        }
        .billing-layout {
            display: grid;
            grid-template-columns: 40% 1fr;
            gap: 30px;
        }

        /* --- Form Styling --- */
        .form-section {
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            box-sizing: border-box;
        }
        .form-group .dimension-group {
            display: flex;
            gap: 10px;
        }
        .form-group .dimension-group > div {
            flex: 1;
        }

        .mode-switcher {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn {
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            border: none;
            transition: opacity 0.3s;
        }
        .btn:hover {
            opacity: 0.85;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }

        /* --- Bill Preview Styling --- */
        .bill-preview {
            border: 2px solid #000;
            padding: 20px;
            height: fit-content;
        }
        .bill-header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .bill-header img {
            max-width: 150px;
            max-height: 80px;
            margin-bottom: 10px;
        }
        .bill-header h2 {
            margin: 0;
            color: #000;
        }
        .bill-header p {
            margin: 2px 0;
            font-size: 0.9em;
        }
        .bill-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .bill-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .bill-table th, .bill-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        .bill-table th {
            background-color: #f2f2f2;
        }
        .bill-table .text-right {
            text-align: right;
        }
        .bill-total {
            text-align: right;
            font-size: 1.5em;
            font-weight: bold;
        }
        .bill-footer {
            margin-top: 40px;
            text-align: center;
            font-style: italic;
        }

        /* --- Hidden Class --- */
        .hidden {
            display: none !important;
        }

        /* --- Print Styling --- */
        @media print {
            body * {
                visibility: hidden;
            }
            .bill-preview, .bill-preview * {
                visibility: visible;
            }
            .bill-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            .container {
                box-shadow: none;
                padding: 0;
                margin: 0;
                width: 100%;
                max-width: 100%;
            }
            .billing-layout {
                display: block;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <nav>
            <h1 id="navCompanyName">Printing Shop</h1>
            <div>
                <button id="navCalcBtn">Calculator</button>
                <button id="navSettingsBtn">Settings</button>
            </div>
        </nav>

        <!-- Main Billing/Calculator Page -->
        <div id="calculatorPage" class="main-content active">
            <div class="billing-layout">
                <!-- Left Side: Form -->
                <div class="form-section">
                    <h2>Create New Bill</h2>
                    
                    <fieldset>
                        <legend>Customer Details</legend>
                        <div class="form-group">
                            <label for="customerName">Customer Name</label>
                            <input type="text" id="customerName" placeholder="Enter customer name">
                        </div>
                        <div class="form-group">
                            <label for="customerAddress">Customer Address</label>
                            <input type="text" id="customerAddress" placeholder="Enter customer address">
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Customer Phone No.</label>
                            <input type="text" id="customerPhone" placeholder="Enter customer phone">
                        </div>
                         <div class="form-group">
                            <label for="billNo">Bill No.</label>
                            <input type="text" id="billNo" placeholder="Enter bill number">
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Product Details</legend>
                        <div class="form-group mode-switcher">
                            <label><input type="radio" name="billingMode" value="normal" checked> Normal</label>
                            <label><input type="radio" name="billingMode" value="dimensional"> Dimensional (Flex, etc.)</label>
                        </div>

                        <div class="form-group">
                            <label for="jobType">Job Type</label>
                            <select id="jobType"></select>
                        </div>
                        
                        <!-- Normal Mode Inputs -->
                        <div id="normalInputs">
                            <div class="form-group">
                                <label for="normalProduct">Product / Description</label>
                                <input type="text" id="normalProduct" placeholder="e.g., T-Shirt Print, 10 Mugs">
                            </div>
                            <div class="form-group">
                                <label for="normalQty">Quantity</label>
                                <input type="number" id="normalQty" placeholder="e.g., 10" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label for="normalRate">Rate (per item)</label>
                                <input type="number" id="normalRate" placeholder="e.g., 150" min="0">
                            </div>
                        </div>

                        <!-- Dimensional Mode Inputs -->
                        <div id="dimensionalInputs" class="hidden">
                             <div class="form-group">
                                <label for="dimensionalProduct">Product / Description</label>
                                <input type="text" id="dimensionalProduct" placeholder="e.g., Shop Banner, Metal Photo">
                            </div>
                            <div class="form-group">
                                <label>Dimensions</label>
                                <div class="dimension-group">
                                    <div>
                                        <input type="number" id="dimWidth" placeholder="Width">
                                    </div>
                                    <div>
                                        <input type="number" id="dimHeight" placeholder="Height">
                                    </div>
                                    <div>
                                        <select id="dimUnit">
                                            <option value="inch">Inches</option>
                                            <option value="feet">Feet</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                             <div class="form-group">
                                <label for="dimRate">Rate (per sq. ft.)</label>
                                <input type="number" id="dimRate" placeholder="e.g., 35" min="0">
                            </div>
                            <div class="form-group">
                                <label for="dimQty">Quantity</label>
                                <input type="number" id="dimQty" value="1" min="1">
                            </div>
                        </div>
                    </fieldset>

                    <div class="action-buttons">
                        <button id="addToBillBtn" class="btn btn-primary">Add to Bill</button>
                    </div>
                </div>

                <!-- Right Side: Bill Preview -->
                <div class="bill-section">
                    <div class="bill-preview" id="billPreview">
                        <div class="bill-header">
                            <img id="billLogo" src=" " alt="Company Logo" class="hidden">
                            <h2 id="billCompanyName">Your Company Name</h2>
                            <p id="billCompanyAddress">Your Company Address</p>
                            <p id="billCompanyPhone">Your Company Phone</p>
                        </div>
                        <div class="bill-info">
                            <div id="billCustomerDetails">
                                <strong>Bill To:</strong>
                                <p id="billCustomerName"></p>
                                <p id="billCustomerAddress"></p>
                                <p id="billCustomerPhone"></p>
                            </div>
                            <div id="billMeta">
                                <strong>Bill No:</strong> <span id="billMetaNo"></span><br>
                                <strong>Date:</strong> <span id="billMetaDate"></span>
                            </div>
                        </div>

                        <table class="bill-table">
                            <thead>
                                <tr>
                                    <th>Description</th>
                                    <th class="text-right">Rate</th>
                                    <th class="text-right">Qty</th>
                                    <th class="text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody id="billItems">
                                <!-- Bill items will be injected here by JavaScript -->
                            </tbody>
                        </table>

                        <div class="bill-total">
                            Total: ₹<span id="billTotalAmount">0.00</span>
                        </div>
                        
                        <div class="bill-footer">
                            <p>Thank You!</p>
                        </div>
                    </div>
                    <div class="action-buttons">
                         <button id="printBillBtn" class="btn btn-success">Print Bill</button>
                         <button id="resetBillBtn" class="btn btn-danger">Reset Bill</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="main-content">
            <h2>Shop Settings</h2>
            <p>Your settings are saved automatically in your browser.</p>
            <div class="form-section">
                <div class="form-group">
                    <label for="settingsCompanyName">Company Name</label>
                    <input type="text" id="settingsCompanyName" placeholder="e.g., Grajuri Chhapakhana">
                </div>
                <div class="form-group">
                    <label for="settingsAddress">Company Address</label>
                    <input type="text" id="settingsAddress" placeholder="e.g., Gaighat-5, Udayapur">
                </div>
                <div class="form-group">
                    <label for="settingsPhone">Company Phone No.</label>
                    <input type="text" id="settingsPhone" placeholder="e.g., 9766114003">
                </div>
                <div class="form-group">
                    <label for="settingsLogo">Company Logo</label>
                    <input type="file" id="settingsLogo" accept="image/*">
                </div>
                <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- DOM Element References ---
        const navCalcBtn = document.getElementById('navCalcBtn');
        const navSettingsBtn = document.getElementById('navSettingsBtn');
        const calculatorPage = document.getElementById('calculatorPage');
        const settingsPage = document.getElementById('settingsPage');

        const modeRadios = document.querySelectorAll('input[name="billingMode"]');
        const normalInputs = document.getElementById('normalInputs');
        const dimensionalInputs = document.getElementById('dimensionalInputs');
        const jobTypeSelect = document.getElementById('jobType');
        const addToBillBtn = document.getElementById('addToBillBtn');
        const printBillBtn = document.getElementById('printBillBtn');
        const resetBillBtn = document.getElementById('resetBillBtn');

        // Settings Form Elements
        const settingsCompanyName = document.getElementById('settingsCompanyName');
        const settingsAddress = document.getElementById('settingsAddress');
        const settingsPhone = document.getElementById('settingsPhone');
        const settingsLogo = document.getElementById('settingsLogo');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        
        // Bill Preview Elements
        const billCompanyName = document.getElementById('billCompanyName');
        const billCompanyAddress = document.getElementById('billCompanyAddress');
        const billCompanyPhone = document.getElementById('billCompanyPhone');
        const billLogo = document.getElementById('billLogo');
        const billItemsTbody = document.getElementById('billItems');
        const billTotalAmountSpan = document.getElementById('billTotalAmount');
        const navCompanyName = document.getElementById('navCompanyName');

        // --- State Management ---
        let billItems = [];
        let companySettings = {
            name: 'Grajuri Chhapakhana',
            address: 'Your Address',
            phone: 'Your Phone',
            logo: ''
        };

        // --- Job Types from your notebook ---
        const jobTypes = [
            'Certificate', 'Flex Normal', 'Flex Sticker', 'Visiting Card', 'Flex Photo', 'Photo Frame', 'Metal Frame', 'Wedding Card',
            'T-shirt Print', 'Jersey Print', 'Light Board', 'Document Print', 'Letter Head', 'Bill Pad', 'Canvas', 'Sticker', 'Vinyl',
            'Cup Print', 'Passport Photo', 'Photo Print', 'Medal', 'Trophy', 'Banner'
        ];

        // --- Functions ---

        function populateJobTypes() {
            jobTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                jobTypeSelect.appendChild(option);
            });
        }

        function switchView(view) {
            calculatorPage.classList.remove('active');
            settingsPage.classList.remove('active');
            if (view === 'calculator') {
                calculatorPage.classList.add('active');
            } else if (view === 'settings') {
                settingsPage.classList.add('active');
            }
        }
        
        function switchBillingMode(mode) {
            if (mode === 'normal') {
                normalInputs.classList.remove('hidden');
                dimensionalInputs.classList.add('hidden');
            } else {
                normalInputs.classList.add('hidden');
                dimensionalInputs.classList.remove('hidden');
            }
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('companySettings');
            if (savedSettings) {
                companySettings = JSON.parse(savedSettings);
            }
            // Update settings form fields
            settingsCompanyName.value = companySettings.name;
            settingsAddress.value = companySettings.address;
            settingsPhone.value = companySettings.phone;
            // Update UI elements
            updateUIWithSettings();
        }

        function saveSettings() {
            companySettings.name = settingsCompanyName.value.trim();
            companySettings.address = settingsAddress.value.trim();
            companySettings.phone = settingsPhone.value.trim();
            
            const file = settingsLogo.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    companySettings.logo = e.target.result;
                    localStorage.setItem('companySettings', JSON.stringify(companySettings));
                    updateUIWithSettings();
                    alert('Settings and new logo saved!');
                };
                reader.readAsDataURL(file);
            } else {
                 localStorage.setItem('companySettings', JSON.stringify(companySettings));
                 updateUIWithSettings();
                 alert('Settings saved!');
            }
        }
        
        function updateUIWithSettings() {
            navCompanyName.textContent = companySettings.name;
            billCompanyName.textContent = companySettings.name;
            billCompanyAddress.textContent = companySettings.address;
            billCompanyPhone.textContent = companySettings.phone;

            if (companySettings.logo) {
                billLogo.src = companySettings.logo;
                billLogo.classList.remove('hidden');
            } else {
                billLogo.classList.add('hidden');
            }
        }

        function updateBillPreview() {
            // Update customer details
            document.getElementById('billCustomerName').textContent = document.getElementById('customerName').value;
            document.getElementById('billCustomerAddress').textContent = document.getElementById('customerAddress').value;
            document.getElementById('billCustomerPhone').textContent = document.getElementById('customerPhone').value;
            document.getElementById('billMetaNo').textContent = document.getElementById('billNo').value;
            document.getElementById('billMetaDate').textContent = new Date().toLocaleDateString('en-GB');

            // Clear current items
            billItemsTbody.innerHTML = '';
            let total = 0;

            // Add new items
            billItems.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.description}</td>
                    <td class="text-right">${item.rate.toFixed(2)}</td>
                    <td class="text-right">${item.quantity}</td>
                    <td class="text-right">₹${item.amount.toFixed(2)}</td>
                `;
                billItemsTbody.appendChild(row);
                total += item.amount;
            });

            // Update total
            billTotalAmountSpan.textContent = total.toFixed(2);
        }

        function addToBill() {
            const mode = document.querySelector('input[name="billingMode"]:checked').value;
            const jobType = jobTypeSelect.value;
            let newItem = {};
            let isValid = true;

            if (mode === 'normal') {
                const description = document.getElementById('normalProduct').value.trim() || jobType;
                const quantity = parseFloat(document.getElementById('normalQty').value);
                const rate = parseFloat(document.getElementById('normalRate').value);

                if (!description || isNaN(quantity) || isNaN(rate) || quantity <= 0 || rate < 0) {
                    alert('Please fill all fields correctly for Normal mode.');
                    isValid = false;
                } else {
                    newItem = {
                        description: description,
                        rate: rate,
                        quantity: quantity,
                        amount: quantity * rate
                    };
                }

            } else { // Dimensional mode
                const description = document.getElementById('dimensionalProduct').value.trim() || jobType;
                let width = parseFloat(document.getElementById('dimWidth').value);
                let height = parseFloat(document.getElementById('dimHeight').value);
                const unit = document.getElementById('dimUnit').value;
                const ratePerSqFt = parseFloat(document.getElementById('dimRate').value);
                const quantity = parseFloat(document.getElementById('dimQty').value);

                if (!description || isNaN(width) || isNaN(height) || isNaN(ratePerSqFt) || isNaN(quantity) || width <= 0 || height <= 0 || ratePerSqFt < 0 || quantity <= 0) {
                    alert('Please fill all fields correctly for Dimensional mode.');
                    isValid = false;
                } else {
                    // Convert to feet if in inches
                    let widthInFeet = (unit === 'inch') ? width / 12 : width;
                    let heightInFeet = (unit === 'inch') ? height / 12 : height;
                    
                    const area = widthInFeet * heightInFeet;
                    const costPerItem = area * ratePerSqFt;
                    const totalAmount = costPerItem * quantity;

                    const fullDescription = `${description} (${width}x${height} ${unit})`;
                    
                    newItem = {
                        description: fullDescription,
                        rate: costPerItem, // The effective rate per item
                        quantity: quantity,
                        amount: totalAmount
                    };
                }
            }

            if (isValid) {
                billItems.push(newItem);
                updateBillPreview();
                clearProductForm();
            }
        }

        function clearProductForm() {
             document.getElementById('normalProduct').value = '';
             document.getElementById('normalQty').value = '1';
             document.getElementById('normalRate').value = '';
             document.getElementById('dimensionalProduct').value = '';
             document.getElementById('dimWidth').value = '';
             document.getElementById('dimHeight').value = '';
             document.getElementById('dimRate').value = '';
             document.getElementById('dimQty').value = '1';
        }

        function resetBill() {
            if (confirm('Are you sure you want to clear the entire bill and start over?')) {
                billItems = [];
                document.getElementById('customerName').value = '';
                document.getElementById('customerAddress').value = '';
                document.getElementById('customerPhone').value = '';
                document.getElementById('billNo').value = '';
                clearProductForm();
                updateBillPreview();
            }
        }
        
        // --- Event Listeners ---
        navCalcBtn.addEventListener('click', () => switchView('calculator'));
        navSettingsBtn.addEventListener('click', () => switchView('settings'));
        
        modeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => switchBillingMode(e.target.value));
        });

        saveSettingsBtn.addEventListener('click', saveSettings);
        addToBillBtn.addEventListener('click', addToBill);
        printBillBtn.addEventListener('click', () => window.print());
        resetBillBtn.addEventListener('click', resetBill);

        // --- Initialization ---
        populateJobTypes();
        loadSettings();
        switchBillingMode('normal'); // Set initial mode
        updateBillPreview(); // Initial draw of the bill
    });
    </script>
</body>
</html>
